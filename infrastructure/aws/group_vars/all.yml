aws:
  ami_name_prefix: ubuntu/images/hvm-ssd/ubuntu-focal-20.04-amd64-server-*
  region: us-west-2
  az: us-west-2a
  key:
    name: "{{ lookup('env', 'KEY_NAME') | default('esten-pf9-mac-rsa', 'true') }}"
    file: "{{ lookup('env', 'KEY_FILE') | default('~/.ssh/id_rsa.pub', 'true') }}"
  tags:
    Product: "{{ lookup('env', 'TAG_PRODUCT') | default('nodectl', true) }}"
    Team: "{{ lookup('env', 'TAG_TEAM') | default('devops', true) }}"
    Environment: "{{ lookup('env', 'TAG_ENVIRONMENT') | default('dev', true) }}"
    Owner: "{{ lookup('env', 'TAG_OWNER') | default('Esten Rye', true) }}"
    Cluster: "{{ lookup('env', 'TAG_CLUSTER') | default('infra-cluster', true) }}"
vpc:
  name: "{{ aws.tags.Environment }}_{{ aws.tags.Product }}_{{ aws.tags.Team }}_{{ aws.tags.Cluster }}"
  cidr_block:
    - 10.5.0.0/16
  subnets:
    public: 10.5.25.0/24
    private: 10.5.50.0/24
  instances:
    - name: jumphost
      role: ssh_proxy
      count: 1
      instance_type: m4.xlarge
      volumes:
        - device_name: /dev/xvdb
          ebs:
              delete_on_termination: true
              encrypted: false
              volume_size: 40
              volume_type: gp3
      mounts:
        - device_name: /dev/xvdb
          path: /opt/pf9
          fstype: ext4
          opts: rw,defaults,nofail,x-systemd.requires=cloud-init.service,_netdev,comment=cloudconfig
    - name: nodelet-controlplane
      role: controlplane
      count: 5
      instance_type: m4.xlarge
      volumes:
        - device_name: /dev/xvdb
          ebs:
              delete_on_termination: true
              encrypted: false
              volume_size: 40
              volume_type: gp3
      mounts:
        - device_name: /dev/xvdb
          path: /opt/pf9
          fstype: ext4
          opts: rw,defaults,nofail,x-systemd.requires=cloud-init.service,_netdev,comment=cloudconfig
    - name: nodelet-worker
      role: worker
      count: 3
      instance_type: z1d.6xlarge
      volumes:
        - device_name: /dev/nvme1n1
          ebs:
              delete_on_termination: true
              encrypted: false
              volume_size: 40
              volume_type: gp3
      mounts:
        - device_name: /dev/nvme1n1
          path: /opt/pf9
          fstype: ext4
          opts: rw,defaults,nofail,x-systemd.requires=cloud-init.service,_netdev,comment=cloudconfig
          

  enable_nat: true

